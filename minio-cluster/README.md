# ğŸ—„ï¸ MinIO Cluster

This directory contains the Kubernetes configuration for deploying a distributed MinIO object storage cluster.

## ğŸ“‹ Overview

The MinIO cluster is configured with:
- **3 servers** with **2 volumes each** (6 total volumes)
- **1Gi storage** per volume
- **Local storage** using persistent volumes
- **NodePort services** for external access
- **Web console** access
- **Pre-configured bucket**: `myservice-artifacts`

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MinIO Cluster                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Server 1 (node-2)    Server 2 (node-3)    Server 3 (node-4)â”‚
â”‚  â”œâ”€â”€ disk1 (1Gi)      â”œâ”€â”€ disk1 (1Gi)      â”œâ”€â”€ disk1 (1Gi) â”‚
â”‚  â””â”€â”€ disk2 (1Gi)      â””â”€â”€ disk2 (1Gi)      â””â”€â”€ disk2 (1Gi) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš™ï¸ Prerequisites

1. **MinIO Operator**: The MinIO operator must be installed in your cluster
2. **Local Storage**: Each node (node-2, node-3, node-4) must have local storage at:
   - `/var/myservice-minio/disk1`
   - `/var/myservice-minio/disk2`
3. **Node Labels**: Ensure your nodes have the correct hostname labels

## ğŸš€ Installation

### 1. ğŸ”§ Install MinIO Operator

```bash
# Add MinIO Helm repository
helm repo add minio https://operator.min.io/
helm repo update

# Create namespace for MinIO operator
kubectl create namespace minio-operator

# Install MinIO operator
helm install minio-operator minio/operator -n minio-operator
```

### 2. ğŸ’¾ Prepare Local Storage

On each node (node-2, node-3, node-4), create the required directories:

```bash
sudo mkdir -p /var/myservice-minio/disk1
sudo mkdir -p /var/myservice-minio/disk2
sudo chmod 755 /var/myservice-minio/disk1
sudo chmod 755 /var/myservice-minio/disk2
```

### 3. ğŸ“¦ Generate Persistent Volumes

```bash
# Make the generator script executable
chmod +x pvs-generator.sh

# Generate the persistent volumes configuration
./pvs-generator.sh
```

This will create `pvs.yml` with persistent volume definitions for all nodes and disks.

### 4. ğŸ¯ Deploy MinIO Cluster

```bash
# Deploy all resources using Kustomize
kubectl apply -k .
```

## ğŸŒ Access

After deployment, MinIO will be accessible via NodePort services:

### ğŸ”Œ MinIO API (S3 Compatible)
- **URL**: `http://<node-ip>:32000`
- **Access Key**: `admin`
- **Secret Key**: `12345678`

### ğŸ–¥ï¸ MinIO Console (Web UI)
- **URL**: `http://<node-ip>:32443`
- **Username**: `admin`
- **Password**: `12345678`

## ğŸ“„ Configuration Files

| File | Description |
|------|-------------|
| `kustomization.yml` | Kustomize configuration and deployment order |
| `namespace.yml` | Creates the `myservice-minio` namespace |
| `secrets.yml` | MinIO credentials and configuration |
| `tenant.yml` | MinIO tenant configuration with cluster specs |
| `services.yml` | NodePort services for external access |
| `storageclass.yml` | Local storage class configuration |
| `pvs.yml` | Persistent volumes (generated by script) |
| `pvs-generator.sh` | Script to generate persistent volumes |

## âš™ï¸ Customization

### ğŸ’¾ Changing Storage Size
Edit `tenant.yml` and modify the `storage` value in the `volumeClaimTemplate`:

```yaml
resources:
  requests:
    storage: 2Gi  # Change from 1Gi to desired size
```

### â• Adding More Servers
1. Update the `NODES` array in `pvs-generator.sh`
2. Update the `servers` count in `tenant.yml`
3. Regenerate persistent volumes: `./pvs-generator.sh`
4. Redeploy: `kubectl apply -k .`

### ğŸ” Changing Credentials
Edit `secrets.yml` and update the `MINIO_ROOT_USER` and `MINIO_ROOT_PASSWORD` values.

## ğŸ“Š Monitoring

Check the status of your MinIO deployment:

```bash
# Check tenant status
kubectl get tenant -n myservice-minio

# Check pods
kubectl get pods -n myservice-minio

# Check services
kubectl get svc -n myservice-minio

# Check persistent volumes
kubectl get pv | grep minio
```

## ğŸ”§ Troubleshooting

### âš ï¸ Common Issues

1. **Pods stuck in Pending**: Check if persistent volumes are available and properly bound
2. **Storage not accessible**: Verify local directories exist on all nodes
3. **Cannot access console**: Check NodePort service and firewall rules

### ğŸ“ Logs

```bash
# Check MinIO operator logs
kubectl logs -n minio-operator -l app.kubernetes.io/name=operator

# Check MinIO tenant logs
kubectl logs -n myservice-minio -l v1.min.io/tenant=myservice-minio
```

## ğŸ”’ Security Notes

âš ï¸ **Important**: The default credentials in `secrets.yml` are for demonstration purposes only. In production:

1. Change the default username and password
2. Use Kubernetes secrets management
3. Enable TLS/SSL for external access
4. Configure proper RBAC policies
5. Use network policies to restrict access

## ğŸ§¹ Cleanup

To remove the MinIO cluster:

```bash
# Delete the MinIO cluster
kubectl delete -k .

# Delete the MinIO operator (optional)
helm uninstall minio-operator -n minio-operator
kubectl delete namespace minio-operator
```
